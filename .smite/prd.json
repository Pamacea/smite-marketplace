{
  "project": "Smite Code Quality & Documentation System",
  "description": "Integrate a comprehensive code quality and documentation system into Smite, including: 1) A Code Critiquer Hook (Quality Gate) that validates complexity, semantic consistency, and security, 2) An MCP Internal Docs Editor that auto-syncs OpenAPI specs, README, and JSDoc, 3) A Super-Hook validation architecture with feedback loops",
  "branchName": "feature/quality-gate-system",
  "userStories": [
    {
      "id": "US-001",
      "title": "Design Code Critiquer Hook Architecture",
      "description": "Architect the 'Quality Gate' hook system that intercepts code changes before commit/completion. The hook should analyze code for complexity, semantic consistency, and security issues. Implement a feedback loop where rejected code is re-injected into the executor context with specific correction instructions.",
      "agent": "architect:architect",
      "tech": "TypeScript, Node.js, Hooks",
      "priority": 1,
      "dependencies": [],
      "acceptanceCriteria": [
        "Architecture document specifies hook integration points (pre-completion, post-file-write)",
        "Feedback loop mechanism clearly defined with context reinjection protocol",
        "Validation criteria documented: cyclomatic complexity, semantic consistency, security patterns",
        "Multi-model consensus option architected (Claude Sonnet critiquing GLM 4.7)",
        "Hook can trigger test execution (npm test, pytest) via MCP integration"
      ],
      "passes": true,
      "notes": "✅ Architecture complete - 1,477 lines. See .smite/architecture-code-critiquer.md"
    },
    {
      "id": "US-002",
      "title": "Implement Core Critiquer Hook",
      "description": "Build the core 'Judge' hook that intercepts code production. The hook should parse generated/modified code, run validation checks (complexity analysis, semantic diffing, security scanning), and either accept or reject with specific feedback. Rejected code should trigger automatic retry with correction instructions.",
      "agent": "builder:builder",
      "tech": "TypeScript, AST analysis, ESLint",
      "priority": 2,
      "dependencies": ["US-001"],
      "acceptanceCriteria": [
        "Hook integrates with Claude Code's hook system (pre-completion or post-file-write)",
        "Parses TypeScript/JavaScript code and generates AST",
        "Calculates cyclomatic complexity and flags functions > 10",
        "Detects semantic inconsistencies (e.g., API changes without caller updates)",
        "Identifies security vulnerabilities (SQL injection, XSS, etc.)",
        "Reinjects correction prompt into executor context on rejection",
        "Logs all validation results for audit trail"
      ],
      "passes": true,
      "notes": "✅ Implementation complete at plugins/quality-gate/. Includes all validators, feedback loop, config system, and audit logging."
    },
    {
      "id": "US-003",
      "title": "Integrate Test Execution in Validation",
      "description": "Enhance the Critiquer Hook to automatically run test suites (npm test, pytest, etc.) when code changes are detected. Parse test results and incorporate failures into rejection feedback.",
      "agent": "builder:builder",
      "tech": "TypeScript, Child Process, Test Parsers",
      "priority": 3,
      "dependencies": ["US-002"],
      "acceptanceCriteria": [
        "Hook spawns test processes and captures output",
        "Parses Jest, pytest, and other test framework outputs",
        "Extracts specific failure messages for feedback",
        "Configurable test command (package.json scripts or config file)",
        "Timeout mechanism to prevent hanging tests",
        "Test results included in rejection prompts"
      ],
      "passes": true,
      "notes": "✅ Test runner module at plugins/quality-gate/src/test-runner.ts with Jest/Vitest/Mocha/pytest support, auto-detection, configurable timeout, and feedback integration."
    },
    {
      "id": "US-004",
      "title": "Design Internal Docs Editor MCP",
      "description": "Design an MCP server that automatically maintains project documentation. The MCP should provide tools for syncing OpenAPI specs, updating README architecture sections, and generating JSDoc/docstrings. Architecture should support file watching and change detection.",
      "agent": "architect:architect",
      "tech": "TypeScript, MCP SDK, File Watchers",
      "priority": 4,
      "dependencies": [],
      "acceptanceCriteria": [
        "MCP server architecture with tool definitions",
        "Tool: sync_openapi_spec - scans routes and updates OpenAPI/Swagger",
        "Tool: update_readme_architecture - updates README based on code changes",
        "Tool: generate_jsdoc_on_fly - adds/updates JSDoc from code logic",
        "File watching strategy for detecting structural changes",
        "Diff generation for documentation updates",
        "Integration points with existing Smite hooks"
      ],
      "passes": true,
      "notes": "✅ Architecture complete - 1,873 lines. See .smite/architecture-docs-editor-mcp.md"
    },
    {
      "id": "US-005",
      "title": "Implement OpenAPI Sync Tool",
      "description": "Build the sync_openapi_spec tool that scans route definitions (Express, FastAPI, Next.js route handlers, etc.) and automatically updates OpenAPI/Swagger specification files. Detect signature changes, new endpoints, and deprecated routes.",
      "agent": "builder:builder",
      "tech": "TypeScript, AST, OpenAPI Parser",
      "priority": 5,
      "dependencies": ["US-004"],
      "acceptanceCriteria": [
        "Scans project for route handlers (Express, FastAPI, Next.js)",
        "Extracts endpoint metadata (path, method, parameters, responses)",
        "Parses TypeScript types for request/response schemas",
        "Updates existing openapi.json or swagger.yaml",
        "Handles new endpoints, modified signatures, and deletions",
        "Generates diffs for review before applying changes",
        "Configurable output paths and formats"
      ],
      "passes": true,
      "notes": "✅ OpenAPI sync tool at plugins/docs-editor-mcp/src/. Supports Express & NextJS, generates OpenAPI 3.0 specs, merges with existing files, supports JSON/YAML output."
    },
    {
      "id": "US-006",
      "title": "Implement README Updater Tool",
      "description": "Build the update_readme_architecture tool that monitors project structure changes and updates README.md sections. Detect new modules, dependencies, and architectural changes. Generate structured updates for Installation, Architecture, and Project Structure sections.",
      "agent": "builder:builder",
      "tech": "TypeScript, Markdown Parser, File System",
      "priority": 6,
      "dependencies": ["US-004"],
      "acceptanceCriteria": [
        "Monitors package.json for dependency changes",
        "Scans src/ directory for new modules/directories",
        "Parses existing README.md to identify update sections",
        "Updates Installation section with new dependencies",
        "Updates Architecture/Project Structure with new modules",
        "Preserves manual edits in non-auto sections",
        "Generates markdown diff for review"
      ],
      "passes": true,
      "notes": "✅ README updater at plugins/docs-editor-mcp/src/. Monitors package.json, scans project structure, updates sections while preserving manual edits with SMITE:MANUAL markers."
    },
    {
      "id": "US-007",
      "title": "Implement JSDoc Generator Tool",
      "description": "Build the generate_jsdoc_on_fly tool that analyzes function logic and generates or updates JSDoc/docstring comments. Should infer parameter types, return types, and descriptions from actual code behavior, not just signatures.",
      "agent": "builder:builder",
      "tech": "TypeScript, AST, Type Inference",
      "priority": 7,
      "dependencies": ["US-004"],
      "acceptanceCriteria": [
        "Analyzes function bodies to infer behavior",
        "Generates JSDoc with @param, @returns, @throws tags",
        "Infers types from TypeScript annotations or usage patterns",
        "Updates existing JSDoc when function signatures change",
        "Handles complex types (generics, unions, intersections)",
        "Preserves manually written descriptions when possible",
        "Configurable overwrite/merge strategy"
      ],
      "passes": true,
      "notes": "✅ JSDoc generator at plugins/docs-editor-mcp/src/. AST-based analysis, type inference, merge/replace/append strategies, supports complex types."
    },
    {
      "id": "US-008",
      "title": "Integrate MCP Scribe with Quality Gate",
      "description": "Connect the Internal Docs Editor MCP with the Critiquer Hook so that documentation updates are automatically triggered after code validation passes. Create a Super-Hook pipeline: Executor → Critique (with retry) → Test → Scribe → Complete.",
      "agent": "builder:builder",
      "tech": "TypeScript, MCP Client, Hooks",
      "priority": 8,
      "dependencies": ["US-003", "US-005", "US-006", "US-007"],
      "acceptanceCriteria": [
        "Critiquer Hook triggers MCP tools after successful validation",
        "Pipeline: Code Production → Critique → (reject → retry) → Test → Docs → Complete",
        "Configurable tool triggers (e.g., only OpenAPI on route changes)",
        "Batch documentation updates to avoid excessive MCP calls",
        "Error handling if MCP tools fail (should not block completion)",
        "Logging of all documentation changes made"
      ],
      "passes": true,
      "notes": "✅ Complete Super-Hook pipeline implemented. MCP client, doc triggers, integration with judge orchestrator. Non-blocking design with configurable triggers."
    },
    {
      "id": "US-009",
      "title": "Add Configuration System",
      "description": "Create a configuration system for the Quality Gate & Docs system. Support project-level config (.smite/quality.json) for enabling/disabling features, setting thresholds (complexity limits), and configuring tool behavior.",
      "agent": "builder:builder",
      "tech": "TypeScript, JSON Schema, Zod",
      "priority": 9,
      "dependencies": ["US-008"],
      "acceptanceCriteria": [
        "Configuration file at .smite/quality.json",
        "JSON Schema validation for config",
        "Settings: complexity threshold, security rules, test commands",
        "Toggle individual features (critiquer, openapi, readme, jsdoc)",
        "Per-file or per-directory overrides",
        "Default configuration bundled with plugin",
        "Config validation on load with clear error messages"
      ],
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-010",
      "title": "Add CLI Commands",
      "description": "Expose quality system features via CLI commands: /smite:quality-check (manual validation), /smite:docs-sync (trigger MCP tools), /smite:quality-config (edit config). Integrate with existing Smite CLI structure.",
      "agent": "builder:builder",
      "tech": "TypeScript, Commander.js",
      "priority": 10,
      "dependencies": ["US-009"],
      "acceptanceCriteria": [
        "Command: /smite:quality-check - runs validation on current changes",
        "Command: /smite:docs-sync - triggers all MCP doc tools",
        "Command: /smite:quality-config - opens config in editor",
        "Commands show helpful output and exit codes",
        "Integration with marketplace plugin listing",
        "Help text and examples for each command"
      ],
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-011",
      "title": "Add Marketplace Integration",
      "description": "Package the Quality Gate & Docs system as a Smite marketplace plugin. Add to plugins/index.json with metadata, dependencies, and installation instructions. Ensure discoverability and easy installation.",
      "agent": "builder:builder",
      "tech": "TypeScript, JSON, NPM",
      "priority": 11,
      "dependencies": ["US-010"],
      "acceptanceCriteria": [
        "Plugin metadata in plugins/index.json",
        "Package name: @smite/quality-gate",
        "Dependencies listed (MCP SDK, AST parsers, etc.)",
        "Installation documentation in README",
        "Version compatibility with Smite core",
        "Example config in plugin package",
        "Feature list and description in marketplace"
      ],
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-012",
      "title": "Write Documentation & Examples",
      "description": "Comprehensive documentation for the Quality Gate & Docs system. Include architecture overview, configuration guide, MCP tool reference, and troubleshooting. Add examples of common workflows and custom rules.",
      "agent": "finalize:finalize",
      "tech": "Markdown",
      "priority": 12,
      "dependencies": ["US-011"],
      "acceptanceCriteria": [
        "README.md with quick start guide",
        "Architecture document explaining hook pipeline",
        "Configuration reference with all options",
        "MCP tool documentation (parameters, outputs)",
        "Troubleshooting guide for common issues",
        "Examples: custom validation rules, custom doc templates",
        "Integration guide for other Smite plugins"
      ],
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-013",
      "title": "Test & Validate Entire System",
      "description": "Comprehensive testing of the Quality Gate & Docs system. Unit tests for validation logic, integration tests for hook pipeline, end-to-end tests for complete workflow. Test with various codebases and edge cases.",
      "agent": "finalize:finalize",
      "tech": "Jest, TypeScript",
      "priority": 13,
      "dependencies": ["US-012"],
      "acceptanceCriteria": [
        "Unit tests for complexity calculation, security scanning",
        "Integration tests for hook trigger scenarios",
        "E2E test: code production → critique → doc update",
        "Test with sample projects (Express, Next.js, FastAPI)",
        "Edge case coverage: empty files, syntax errors, circular deps",
        "Performance tests: large codebases, many files",
        "All tests passing with >80% coverage"
      ],
      "passes": false,
      "notes": ""
    }
  ]
}
